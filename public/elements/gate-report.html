<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/more-routing/more-route.html">
<link rel="import" href="../components/iron-ajax/iron-ajax.html">


<dom-module id="gate-report">

  <template>
    <more-route path="/gates/:name" context params="{{params}}"></more-route>
    <iron-ajax id="ajax" auto handle-as="json" last-response="{{ajaxResponse}}" on-response="handleResponse"></iron-ajax>

    <h1>Gate <span>{{params.name}}</span></h1>
    <table class="table table-bordered table-striped">
      <thead>
      <tr>
        <th>Occurred At</th>
        <th>GPU HZ400</th>
        <th>PBB ACF</th>
      </tr>
      </thead>
      <tbody>
      <template is="dom-repeat" items="[[alarms]]" as="item">
        <tr>
          <td>{{getElementAt(item)}}</td>
          <td>[[item.Gate_C_1_GPU_Alarm_HZ400FAULT]]</td>
          <td>[[item.Gate_C_1_PBB_Alarm_ACF_Alarm]]</td>
        </tr>
      </template>
      </tbody>
    </table>

  </template>

</dom-module>

<script>
  Polymer({
    is: 'gate-report',

    properties: {
      params: Object,
      alarms: Array
    },

    ready: function () {
      this.$.ajax.url = '/v1/gates/' + this.params.name;
    },

    handleResponse: function (e) {
      this.alarms = e.detail;
    },

    getKeys: function (item) {
      return Object.keys(item)
    },

    getElementAt: function (item) {
      var key = Object.keys(item)[0];
      return item[key];
    },

    getValue: function(item, key){
      return item[key];
    }
  })
</script>